<html>
  <head>

    <!-- development version, includes helpful console warnings -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <!-- production version, optimized for size and speed -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->

    <style type="text/css">
      @import url('https://fonts.googleapis.com/css2?family=Roboto+Slab&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@500&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@500&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Sawarabi+Mincho&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Potta+One&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Yusei+Magic&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Hachi+Maru+Pop&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=M+PLUS+1p:wght@500&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Sawarabi+Gothic&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Kosugi&display=swap');
      .font-family-noto-serif-jp {
          font-family: 'Noto Serif JP';
      }
      .font-family-sawarabi-mincho {
        font-family: 'Sawarabi Mincho', sans-serif;
      }
      .font-family-potta-one {
        font-family: 'Potta One', cursive;
      }
      .font-family-yusei-magic {
        font-family: 'Yusei Magic', san-serif;
      }
      .font-family-hachi-maru-pop {
        font-family: 'Hachi Maru Pop', cursive;
      }
      .font-family-m-plus-1p {
        font-family: 'M PLUS 1p', sans-serif;
      }
      .font-family-sawarabi-gothic {
        font-family: 'Sawarabi Gothic', sans-serif;
      }
      .font-family-kosugi {
        font-family: 'Kosugi', sans-serif;
      }
    </style>

    <!-- Alternate colors:

        persimmon: e55812
        coffee: 774936

    -->

    <style type="text/css">
      body {
          font-size: 6em;
          background-color: #e0d0c1;
      }
      .question {
          margin-top: 1em;
          text-align: center;
      }
      .answer {
          margin-top: .6em;
          margin-bottom: .6em;
          margin-left: .8em;
      }
      .dialog {
          position: fixed;
          top: 0;
          bottom: 0;
          left: 0;
          right: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(224, 208, 193, 0.8);
          margin: 0;
          border: 0;
      }
      .dialog_content {
          margin-top: 1.5em;
          margin-left: auto;
          margin-right: auto;
          padding: .5em;
          width: 85%;
          background-color: #e0d0c1;
          border-style: solid;
          border-width: .1em;
          border-radius: .2em;
      }
      .correct-header {
          color: #4CAF50;
          font-size: 1.5em;
          font-weight: bold;
      }
      .wrong-header {
          color: #f44336;
          font-size: 1.5em;
          font-weight: bold;
      }
      .dialog-button {
          margin-top: 2em;
          color: #fff;
          width: auto;
          text-align: center;
          background-color: #5d737e;
      }
      .debug-button {
          padding-left: .5em;
          font-size: 1em;
          color: #000;
          width: auto;
          position: fixed;
          bottom: 10px;
          right: 5px;
      }
      .change-font-button {
          font-size: 1em;
          color: #000;
          width: auto;
          position: fixed;
          bottom: 10px;
          right: 1.5em;
      }
      .full-concept-json {
          font-size: .5em;
      }
      .remove-stats-button {
          padding-left: .5em;
          font-size: .75em;
          color: #fff;
          background-color: #884CBA;
          width: auto;
          margin-top: 1em;
          margin-bottom: 1em;
      }
      .debug {
          font-size: .25em;
      }
      .app-header {
          border: 0;
          margin: 0;
          margin-bottom: 1em;
          text-align: center;
          color: #fff;
          background-color: #774936;
      }
      #app {
         font-family: 'Roboto Slab', serif;
      }
    </style>
  </head>

  <body>
    <div id="app">

      <div class="app-header">
        Hiragana ‚ü∑ Romaji
      </div>

      <div :class="$data.font_family">

      <div class="question">
        {{ get_question_text($data) }}
      </div>

      <!--
      <div v-for="concept_idx in concept_idxs">
        <div class="answer" onclick="check_answer(0); event.stopPropagation()">
          {{ get_question_text($data) }}
        </div>
      </div>
      -->

      <div v-if="concepts.length > 0" class="answer" onclick="check_answer(0)">
        {{ get_answer_text($data, 0) }}                                                    
      </div>
      <div v-if="concepts.length > 1" class="answer" onclick="check_answer(1)">
        {{ get_answer_text($data, 1) }}
      </div>
      <div v-if="concepts.length > 2" class="answer" onclick="check_answer(2)">
        {{ get_answer_text($data, 2) }}
      </div>
      <div v-if="concepts.length > 3" class="answer" onclick="check_answer(3)">
        {{ get_answer_text($data, 3) }}
      </div>
      <div v-if="concepts.length > 4" class="answer" onclick="check_answer(4)">
        {{ get_answer_text($data, 4) }}
      </div>
      <div v-if="concepts.length > 5" class="answer" onclick="check_answer(5)">
        {{ get_answer_text($data, 5) }}
      </div>
      <div v-if="concepts.length > 6" class="answer" onclick="check_answer(6)">
        {{ get_answer_text($data, 6) }}
      </div>
      <div v-if="concepts.length > 7" class="answer" onclick="check_answer(7)">
        {{ get_answer_text($data, 7) }}
      </div>
      <div v-if="concepts.length > 8" class="answer" onclick="check_answer(8)">
        {{ get_answer_text($data, 8) }}
      </div>
      <div v-if="concepts.length > 9" class="answer" onclick="check_answer(9)">
        {{ get_answer_text($data, 9) }}
      </div>

      </div>

      <div v-if="show_correct || show_wrong" class="dialog">
        <div class="dialog_content">
          <div v-if="show_correct" class="correct-header">Correct</div>
          <div v-if="show_wrong" class="wrong-header">Wrong</div>
          <div>
            {{ get_question_text($data) }}
          </div>
          <div>
            {{ get_question_answer_text($data) }}
          </div>
          <pre class="full-concept-json">{{ JSON.stringify(answer, null, 2) }}</pre>
          <div class="dialog-button" onclick="select_next_question(); event.stopPropagation()">
            Next question
          </div>
        </div>
      </div>

      <div v-if="debug">
       <div class="dialog-button" onclick="hide_debug()">Hide Debug</div>
        <div class="debug">
         <pre> {{ JSON.stringify($data, null, 2) }} </pre>
        </div>
       <div class="remove-stats-button" onclick="clear_local_storage();">Remove stats</div>
     </div>

     <div v-if="!debug">
       <div class="debug-button" onclick="show_debug()">&#x2699;</div>
       <div class="change-font-button" onclick="change_font()">A<sub>B<sub>C</sub></sub></div> <!-- &#x270d; -->
     </div>
    </div>
  </body>

  <script type="text/javascript">

    var FONT_FAMILIES = [
       'font-family-noto-serif-jp',
       'font-family-sawarabi-mincho',
       'font-family-potta-one',
       'font-family-yusei-magic',
       'font-family-hachi-maru-pop',
       'font-family-m-plus-1p',
       'font-family-sawarabi-gothic',
       'font-family-kosugi',
    ];

    var stats = function() {
        var item = localStorage.getItem('stats');
        if (item === null) {
            return {
                global: {
                    waterline_index: 0,
                }
            };
        } else {
            return JSON.parse(item);
        }
    }();

    function clear_local_storage() {
      localStorage.removeItem('stats');
      console.log('Local storatge is now', localStorage.getItem('stats'));
    }

    function get_concept(index) {
        return all_concepts[index];
    }

    function get_question_text(data) {
        function get_question_text_from_concept(concept, direction) {
            return concept[direction.direction_start];
        }
        return get_question_text_from_concept(data.answer, data.direction);
    }

    function get_question_answer_text(data) {
        function get_answer_text_from_concept(concept, direction) {
            return concept[direction.direction_end];
        }
        return get_answer_text_from_concept(data.answer, data.direction);
    }

    function get_answer_text(data, position) {
        function get_answer_text_from_concept(concept, direction) {
            return concept[direction.direction_end];
        }
        return get_answer_text_from_concept(data.concepts[position], data.direction);
    }

    function make_direction(question, answer, id_match) {
      return {
        direction_name: question + '__to__' + answer,
        direction_start: question,
        direction_end: answer,
        direction_id_match: id_match,
      };
    }

    var directions = [
        make_direction('romaji', 'hiragana', ['h']),
        make_direction('hiragana', 'romaji', ['h']),
        make_direction('romaji', 'katakana', ['k']),
        make_direction('katakana', 'romaji', ['k']),
        make_direction('hiragana', 'english', ['n']),
        make_direction('english', 'hiragana', ['n']),

        // make_direction('romaji', 'english', ['v']),
        // make_direction('hiragana', 'english', ['v']),
        // make_direction('english', 'hiragana', ['v']),
    ]

    var all_concepts = [
        /* ============================================================ */
        /* Hirigana */
        /* ============================================================ */
        {
            id: 'h-a',
            romaji: 'a',
            hiragana: '„ÅÇ',
        },
        {
            id: 'h-i',
            romaji: 'i',
            hiragana: '„ÅÑ',
        },
        {
            id: 'h-u',
            romaji: 'u',
            hiragana: '„ÅÜ',
        },
        {
            id: 'h-e',
            romaji: 'e',
            hiragana: '„Åà',
        },
        {
            id: 'h-o',
            romaji: 'o',
            hiragana: '„Åä',
        },
        {
            id: 'h-ka',
            romaji: 'ka',
            hiragana: '„Åã',
        },
        {
            id: 'h-ki',
            romaji: 'ki',
            hiragana: '„Åç',
        },
        {
            id: 'h-ku',
            romaji: 'ku',
            hiragana: '„Åè',
        },
        {
            id: 'h-ke',
            romaji: 'ke',
            hiragana: '„Åë',
        },
        {
            id: 'h-ko',
            romaji: 'ko',
            hiragana: '„Åì',
        },
        {
            id: 'h-sa',
            romaji: 'sa',
            hiragana: '„Åï',
        },
        {
            id: 'h-shi',
            romaji: 'shi',
            hiragana: '„Åó',
        },
        {
            id: 'h-su',
            romaji: 'su',
            hiragana: '„Åô',
        },
        {
            id: 'h-se',
            romaji: 'se',
            hiragana: '„Åõ',
        },
        {
            id: 'h-so',
            romaji: 'so',
            hiragana: '„Åù',
        },
        {
            id: 'h-ta',
            romaji: 'ta',
            hiragana: '„Åü',
        },
        {
            id: 'h-chi',
            romaji: 'chi',
            hiragana: '„Å°',
        },
        {
            id: 'h-tsu',
            romaji: 'tsu',
            hiragana: '„Å§',
        },
        {
            id: 'h-te',
            romaji: 'te',
            hiragana: '„Å¶',
        },
        {
            id: 'h-to',
            romaji: 'to',
            hiragana: '„Å®',
        },
        {
            id: 'h-na',
            romaji: 'na',
            hiragana: '„Å™',
        },
        {
            id: 'h-ni',
            romaji: 'ni',
            hiragana: '„Å´',
        },
        {
            id: 'h-nu',
            romaji: 'nu',
            hiragana: '„Å¨',
        },
        {
            id: 'h-ne',
            romaji: 'ne',
            hiragana: '„Å≠',
        },
        {
            id: 'h-no',
            romaji: 'no',
            hiragana: '„ÅÆ',
        },
        {
            id: 'h-ha',
            romaji: 'ha',
            hiragana: '„ÅØ',
        },
        {
            id: 'h-hi',
            romaji: 'hi',
            hiragana: '„Å≤',
        },
        {
            id: 'h-hu',
            romaji: 'hu',
            hiragana: '„Åµ',
        },
        {
            id: 'h-he',
            romaji: 'he',
            hiragana: '„Å∏',
        },
        {
            id: 'h-ho',
            romaji: 'ho',
            hiragana: '„Åª',
        },
        {
            id: 'h-ma',
            romaji: 'ma',
            hiragana: '„Åæ',
        },
        {
            id: 'h-mi',
            romaji: 'mi',
            hiragana: '„Åø',
        },
        {
            id: 'h-mu',
            romaji: 'mu',
            hiragana: '„ÇÄ',
        },
        {
            id: 'h-me',
            romaji: 'me',
            hiragana: '„ÇÅ',
        },
        {
            id: 'h-mo',
            romaji: 'mo',
            hiragana: '„ÇÇ',
        },
        {
            id: 'h-ya',
            romaji: 'ya',
            hiragana: '„ÇÑ',
        },
        {
            id: 'h-yu',
            romaji: 'yu',
            hiragana: '„ÇÜ',
        },
        {
            id: 'h-yo',
            romaji: 'yo',
            hiragana: '„Çà',
        },
        {
            id: 'h-ra',
            romaji: 'ra',
            hiragana: '„Çâ',
        },
        {
            id: 'h-ri',
            romaji: 'ri',
            hiragana: '„Çä',
        },
        {
            id: 'h-ru',
            romaji: 'ru',
            hiragana: '„Çã',
        },
        {
            id: 'h-re',
            romaji: 're',
            hiragana: '„Çå',
        },
        {
            id: 'h-ro',
            romaji: 'ro',
            hiragana: '„Çç',
        },
        {
            id: 'h-wa',
            romaji: 'wa',
            hiragana: '„Çè',
        },
        {
            id: 'h-wi',
            romaji: 'wi',
            hiragana: '„Çê',
        },
        {
            id: 'h-we',
            romaji: 'we',
            hiragana: '„Çë',
        },
        {
            id: 'h-wo',
            romaji: 'wo',
            hiragana: '„Çí',
        },
        {
            id: 'h-ga',
            romaji: 'ga',
            hiragana: '„Åå',
        },
        {
            id: 'h-gi',
            romaji: 'gi',
            hiragana: '„Åé',
        },
        {
            id: 'h-gu',
            romaji: 'gu',
            hiragana: '„Åê',
        },
        {
            id: 'h-ge',
            romaji: 'ge',
            hiragana: '„Åí',
        },
        {
            id: 'h-go',
            romaji: 'go',
            hiragana: '„Åî',
        },
        {
            id: 'h-za',
            romaji: 'za',
            hiragana: '„Åñ',
        },
        {
            id: 'h-zi',
            romaji: 'ji (zi)',
            hiragana: '„Åò',
        },
        {
            id: 'h-zu',
            romaji: 'zu',
            hiragana: '„Åö',
        },
        {
            id: 'h-ze',
            romaji: 'ze',
            hiragana: '„Åú',
        },
        {
            id: 'h-zo',
            romaji: 'zo',
            hiragana: '„Åû',
        },
        {
            id: 'h-da',
            romaji: 'da',
            hiragana: '„Å†',
        },
        {
            id: 'h-di',
            romaji: 'ji (di)',
            hiragana: '„Å¢',
        },
        {
            id: 'h-du',
            romaji: 'zu (du)',
            hiragana: '„Å•',
        },
        {
            id: 'h-de',
            romaji: 'de',
            hiragana: '„Åß',
        },
        {
            id: 'h-do',
            romaji: 'do',
            hiragana: '„Å©',
        },
        {
            id: 'h-ba',
            romaji: 'ba',
            hiragana: '„Å∞',
        },
        {
            id: 'h-bi',
            romaji: 'bi',
            hiragana: '„Å≥',
        },
        {
            id: 'h-bu',
            romaji: 'bu',
            hiragana: '„Å∂',
        },
        {
            id: 'h-be',
            romaji: 'be',
            hiragana: '„Åπ',
        },
        {
            id: 'h-bo',
            romaji: 'bo',
            hiragana: '„Åº',
        },
        {
            id: 'h-pa',
            romaji: 'pa',
            hiragana: '„Å±',
        },
        {
            id: 'h-pi',
            romaji: 'pi',
            hiragana: '„Å¥',
        },
        {
            id: 'h-pu',
            romaji: 'pu',
            hiragana: '„Å∑',
        },
        {
            id: 'h-pe',
            romaji: 'pe',
            hiragana: '„Å∫',
        },
        {
            id: 'h-po',
            romaji: 'po',
            hiragana: '„ÅΩ',
        },
        {
            id: 'h-kya',
            romaji: 'kya',
            hiragana: '„Åç„ÇÉ',
        },
        {
            id: 'h-kyu',
            romaji: 'kyu',
            hiragana: '„Åç„ÇÖ',
        },
        {
            id: 'h-kyo',
            romaji: 'kyo',
            hiragana: '„Åç„Çá',
        },
        {
            id: 'h-sha',
            romaji: 'sha',
            hiragana: '„Åó„ÇÉ',
        },
        {
            id: 'h-shu',
            romaji: 'shu',
            hiragana: '„Åó„ÇÖ',
        },
        {
            id: 'h-sho',
            romaji: 'sho',
            hiragana: '„Åó„Çá',
        },
        {
            id: 'h-cha',
            romaji: 'cha',
            hiragana: '„Å°„ÇÉ',
        },
        {
            id: 'h-chu',
            romaji: 'chu',
            hiragana: '„Å°„ÇÖ',
        },
        {
            id: 'h-cho',
            romaji: 'cho',
            hiragana: '„Å°„Çá',
        },
        {
            id: 'h-nya',
            romaji: 'nya',
            hiragana: '„Å´„ÇÉ',
        },
        {
            id: 'h-nyu',
            romaji: 'nyu',
            hiragana: '„Å´„ÇÖ',
        },
        {
            id: 'h-nyo',
            romaji: 'nyo',
            hiragana: '„Å´„Çá',
        },
        {
            id: 'h-hya',
            romaji: 'hya',
            hiragana: '„Å≤„ÇÉ',
        },
        {
            id: 'h-hyu',
            romaji: 'hyu',
            hiragana: '„Å≤„ÇÖ',
        },
        {
            id: 'h-hyo',
            romaji: 'hyo',
            hiragana: '„Å≤„Çá',
        },
        {
            id: 'h-mya',
            romaji: 'mya',
            hiragana: '„Åø„ÇÉ',
        },
        {
            id: 'h-myu',
            romaji: 'myu',
            hiragana: '„Åø„ÇÖ',
        },
        {
            id: 'h-myo',
            romaji: 'myo',
            hiragana: '„Åø„Çá',
        },
        {
            id: 'h-rya',
            romaji: 'rya',
            hiragana: '„Çä„ÇÉ',
        },
        {
            id: 'h-ryu',
            romaji: 'ryu',
            hiragana: '„Çä„ÇÖ',
        },
        {
            id: 'h-ryo',
            romaji: 'ryo',
            hiragana: '„Çä„Çá',
        },
        {
            id: 'h-gya',
            romaji: 'gya',
            hiragana: '„Åé„ÇÉ',
        },
        {
            id: 'h-gyu',
            romaji: 'gyu',
            hiragana: '„Åé„ÇÖ',
        },
        {
            id: 'h-gyo',
            romaji: 'gyo',
            hiragana: '„Åé„Çá',
        },
        {
            id: 'h-ja',
            romaji: 'ja',
            hiragana: '„Åò„ÇÉ',
        },
        {
            id: 'h-ju',
            romaji: 'ju',
            hiragana: '„Åò„ÇÖ',
        },
        {
            id: 'h-jo',
            romaji: 'jo',
            hiragana: '„Åò„Çá',
        },
        /* Do these ever actually occur? */
/*
        {
            id: 'h-ja',
            romaji: 'ja',
            hiragana: '„Å¢„ÇÉ',
        },
        {
            id: 'h-ju',
            romaji: 'ju',
            hiragana: '„Å¢„ÇÖ',
        },
        {
            id: 'h-jo',
            romaji: 'jo',
            hiragana: '„Å¢„Çá',
        },
*/

        {
            id: 'h-bya',
            romaji: 'bya',
            hiragana: '„Å≥„ÇÉ',
        },
        {
            id: 'h-byu',
            romaji: 'byu',
            hiragana: '„Å≥„ÇÖ',
        },
        {
            id: 'h-byo',
            romaji: 'byo',
            hiragana: '„Å≥„Çá',
        },
        {
            id: 'h-pya',
            romaji: 'pya',
            hiragana: '„Å¥„ÇÉ',
        },
        {
            id: 'h-pyu',
            romaji: 'pyu',
            hiragana: '„Å¥„ÇÖ',
        },
        {
            id: 'h-pyo',
            romaji: 'pyo',
            hiragana: '„Å¥„Çá',
        },

        /* ============================================================ */
        /* Katakana */
        /* ============================================================ */

        {
            id: 'k-a',
            romaji: 'a',
            katakana: '„Ç¢',
        },
        {
            id: 'k-i',
            romaji: 'i',
            katakana: '„Ç§',
        },
        {
            id: 'k-u',
            romaji: 'u',
            katakana: '„Ç¶',
        },
        {
            id: 'k-e',
            romaji: 'e',
            katakana: '„Ç®',
        },
        {
            id: 'k-o',
            romaji: 'o',
            katakana: '„Ç™',
        },
        {
            id: 'k-ka',
            romaji: 'ka',
            katakana: '„Ç´',
        },
        {
            id: 'k-ki',
            romaji: 'ki',
            katakana: '„Ç≠',
        },
        {
            id: 'k-ku',
            romaji: 'ku',
            katakana: '„ÇØ',
        },
        {
            id: 'k-ke',
            romaji: 'ke',
            katakana: '„Ç±',
        },
        {
            id: 'k-ko',
            romaji: 'ko',
            katakana: '„Ç≥',
        },
        {
            id: 'k-sa',
            romaji: 'sa',
            katakana: '„Çµ',
        },
        {
            id: 'k-shi',
            romaji: 'shi',
            katakana: '„Ç∑',
        },
        {
            id: 'k-su',
            romaji: 'su',
            katakana: '„Çπ',
        },
        {
            id: 'k-se',
            romaji: 'se',
            katakana: '„Çª',
        },
        {
            id: 'k-so',
            romaji: 'so',
            katakana: '„ÇΩ',
        },
        {
            id: 'k-ta',
            romaji: 'ta',
            katakana: '„Çø',
        },
        {
            id: 'k-chi',
            romaji: 'chi',
            katakana: '„ÉÅ',
        },
        {
            id: 'k-tsu',
            romaji: 'tsu',
            katakana: '„ÉÑ',
        },
        {
            id: 'k-te',
            romaji: 'te',
            katakana: '„ÉÜ',
        },
        {
            id: 'k-to',
            romaji: 'to',
            katakana: '„Éà',
        },
        {
            id: 'k-na',
            romaji: 'na',
            katakana: '„Éä',
        },
        {
            id: 'k-ni',
            romaji: 'ni',
            katakana: '„Éã',
        },
        {
            id: 'k-nu',
            romaji: 'nu',
            katakana: '„Éå',
        },
        {
            id: 'k-ne',
            romaji: 'ne',
            katakana: '„Éç',
        },
        {
            id: 'k-no',
            romaji: 'no',
            katakana: '„Éé',
        },
        {
            id: 'k-ha',
            romaji: 'ha',
            katakana: '„Éè',
        },
        {
            id: 'k-hi',
            romaji: 'hi',
            katakana: '„Éí',
        },
        {
            id: 'k-hu',
            romaji: 'hu',
            katakana: '„Éï',
        },
        {
            id: 'k-he',
            romaji: 'he',
            katakana: '„Éò',
        },
        {
            id: 'k-ho',
            romaji: 'ho',
            katakana: '„Éõ',
        },
        {
            id: 'k-ma',
            romaji: 'ma',
            katakana: '„Éû',
        },
        {
            id: 'k-mi',
            romaji: 'mi',
            katakana: '„Éü',
        },
        {
            id: 'k-mu',
            romaji: 'mu',
            katakana: '„É†',
        },
        {
            id: 'k-me',
            romaji: 'me',
            katakana: '„É°',
        },
        {
            id: 'k-mo',
            romaji: 'mo',
            katakana: '„É¢',
        },
        {
            id: 'k-ya',
            romaji: 'ya',
            katakana: '„É§',
        },
        {
            id: 'k-yu',
            romaji: 'yu',
            katakana: '„É¶',
        },
        {
            id: 'k-yo',
            romaji: 'yo',
            katakana: '„É®',
        },
        {
            id: 'k-ra',
            romaji: 'ra',
            katakana: '„É©',
        },
        {
            id: 'k-ri',
            romaji: 'ri',
            katakana: '„É™',
        },
        {
            id: 'k-ru',
            romaji: 'ru',
            katakana: '„É´',
        },
        {
            id: 'k-re',
            romaji: 're',
            katakana: '„É¨',
        },
        {
            id: 'k-ro',
            romaji: 'ro',
            katakana: '„É≠',
        },
        {
            id: 'k-wa',
            romaji: 'wa',
            katakana: '„ÉØ',
        },
        {
            id: 'k-wi',
            romaji: 'wi',
            katakana: '„É∞',
        },
        {
            id: 'k-we',
            romaji: 'we',
            katakana: '„É±',
        },
        {
            id: 'k-wo',
            romaji: 'wo',
            katakana: '„É≤',
        },
        {
            id: 'k-ga',
            romaji: 'ga',
            katakana: '„Ç¨',
        },
        {
            id: 'k-gi',
            romaji: 'gi',
            katakana: '„ÇÆ',
        },
        {
            id: 'k-gu',
            romaji: 'gu',
            katakana: '„Ç∞',
        },
        {
            id: 'k-ge',
            romaji: 'ge',
            katakana: '„Ç≤',
        },
        {
            id: 'k-go',
            romaji: 'go',
            katakana: '„Ç¥',
        },
        {
            id: 'k-za',
            romaji: 'za',
            katakana: '„Ç∂',
        },
        {
            id: 'k-ji',
            romaji: 'ji',
            katakana: '„Ç∏',
        },
        {
            id: 'k-zu',
            romaji: 'zu',
            katakana: '„Ç∫',
        },
        {
            id: 'k-ze',
            romaji: 'ze',
            katakana: '„Çº',
        },
        {
            id: 'k-zo',
            romaji: 'zo',
            katakana: '„Çæ',
        },
        {
            id: 'k-da',
            romaji: 'da',
            katakana: '„ÉÄ',
        },
        {
            id: 'k-zhi',
            romaji: 'zhi',
            katakana: '„ÉÇ',
        },
        {
            id: 'k-zu',
            romaji: 'zu',
            katakana: '„ÉÖ',
        },
        {
            id: 'k-de',
            romaji: 'de',
            katakana: '„Éá',
        },
        {
            id: 'k-do',
            romaji: 'do',
            katakana: '„Éâ',
        },
        {
            id: 'k-ba',
            romaji: 'ba',
            katakana: '„Éê',
        },
        {
            id: 'k-bi',
            romaji: 'bi',
            katakana: '„Éì',
        },
        {
            id: 'k-bu',
            romaji: 'bu',
            katakana: '„Éñ',
        },
        {
            id: 'k-be',
            romaji: 'be',
            katakana: '„Éô',
        },
        {
            id: 'k-bo',
            romaji: 'bo',
            katakana: '„Éú',
        },
        {
            id: 'k-pa',
            romaji: 'pa',
            katakana: '„Éë',
        },
        {
            id: 'k-pi',
            romaji: 'pi',
            katakana: '„Éî',
        },
        {
            id: 'k-pu',
            romaji: 'pu',
            katakana: '„Éó',
        },
        {
            id: 'k-pe',
            romaji: 'pe',
            katakana: '„Éö',
        },
        {
            id: 'k-po',
            romaji: 'po',
            katakana: '„Éù',
        },
        {
            id: 'k-kya',
            romaji: 'kya',
            katakana: '„Ç≠„É£',
        },
        {
            id: 'k-kyu',
            romaji: 'kyu',
            katakana: '„Ç≠„É•',
        },
        {
            id: 'k-kyo',
            romaji: 'kyo',
            katakana: '„Ç≠„Éß',
        },
        {
            id: 'k-sha',
            romaji: 'sha',
            katakana: '„Ç∑„É£',
        },
        {
            id: 'k-shu',
            romaji: 'shu',
            katakana: '„Ç∑„É•',
        },
        {
            id: 'k-sho',
            romaji: 'sho',
            katakana: '„Ç∑„Éß',
        },
        {
            id: 'k-cha',
            romaji: 'cha',
            katakana: '„ÉÅ„É£',
        },
        {
            id: 'k-chu',
            romaji: 'chu',
            katakana: '„ÉÅ„É•',
        },
        {
            id: 'k-cho',
            romaji: 'cho',
            katakana: '„ÉÅ„Éß',
        },
        {
            id: 'k-nya',
            romaji: 'nya',
            katakana: '„Éã„É£',
        },
        {
            id: 'k-nyu',
            romaji: 'nyu',
            katakana: '„Éã„É•',
        },
        {
            id: 'k-nyo',
            romaji: 'nyo',
            katakana: '„Éã„Éß',
        },
        {
            id: 'k-hya',
            romaji: 'hya',
            katakana: '„Éí„É£',
        },
        {
            id: 'k-hyu',
            romaji: 'hyu',
            katakana: '„Éí„É•',
        },
        {
            id: 'k-hyo',
            romaji: 'hyo',
            katakana: '„Éí„Éß',
        },
        {
            id: 'k-mya',
            romaji: 'mya',
            katakana: '„Éü„É£',
        },
        {
            id: 'k-myu',
            romaji: 'myu',
            katakana: '„Éü„É•',
        },
        {
            id: 'k-myo',
            romaji: 'myo',
            katakana: '„Éü„Éß',
        },
        {
            id: 'k-rya',
            romaji: 'rya',
            katakana: '„É™„É£',
        },
        {
            id: 'k-ryu',
            romaji: 'ryu',
            katakana: '„É™„É•',
        },
        {
            id: 'k-ryo',
            romaji: 'ryo',
            katakana: '„É™„Éß',
        },
        {
            id: 'k-gya',
            romaji: 'gya',
            katakana: '„ÇÆ„É£',
        },
        {
            id: 'k-gyu',
            romaji: 'gyu',
            katakana: '„ÇÆ„É•',
        },
        {
            id: 'k-gyo',
            romaji: 'gyo',
            katakana: '„ÇÆ„Éß',
        },
        {
            id: 'k-ja',
            romaji: 'ja',
            katakana: '„Ç∏„É£',
        },
        {
            id: 'k-ju',
            romaji: 'ju',
            katakana: '„Ç∏„É•',
        },
        {
            id: 'k-jo',
            romaji: 'jo',
            katakana: '„Ç∏„Éß',
        },
        {
            id: 'k-bya',
            romaji: 'bya',
            katakana: '„Éì„É£',
        },
        {
            id: 'k-byu',
            romaji: 'byu',
            katakana: '„Éì„É•',
        },
        {
            id: 'k-byo',
            romaji: 'byo',
            katakana: '„Éì„Éß',
        },
        {
            id: 'k-pya',
            romaji: 'pya',
            katakana: '„Éî„É£',
        },
        {
            id: 'k-pyu',
            romaji: 'pyu',
            katakana: '„Éî„É•',
        },
        {
            id: 'k-pyo',
            romaji: 'pyo',
            katakana: '„Éî„Éß',
        },

        /* TODO(jawilson): katakana new method see

           https://www.coscom.co.jp/hiragana-katakana/kanatable.html

        */

        /* ================================================================ */
        /* Simple Nouns */
        /* ================================================================ */
        {
            id: 'n-kodomo',
            romaji: 'kodomo',
            hiragana: '„Åì„Å©„ÇÇ',
            kanji: 'Â≠ê‰æõ',
            english: 'child',
        },
        {
            id: 'n-dansei',
            romaji: 'dansei',
            hiragana: '„Å†„Çì„Åõ„ÅÑ',
            kanji: 'Áî∑ÊÄß',
            english: 'man',
        },
        {
            id: 'n-jyosei',
            romaji: 'jyosei',
            hiragana: '„Åò„Çá„Åõ„ÅÑ',
            kanji: 'Â•≥ÊÄß',
            english: 'woman',
        },
        {
            id: 'n-kazoku',
            romaji: 'kazoku',
            hiragana: '„Åã„Åû„Åè',
            kanji: 'ÂÆ∂Êóè',
            english: 'family',
        },
        {
            id: 'n-machi',
            romaji: 'machi',
            hiragana: '„Åæ„Å°',
            kanji: 'Áî∫',
            english: 'town / city',
        },
        {
            id: 'n-inaka',
            romaji: 'inaka',
            hiragana: '„ÅÑ„Å™„Åã',
            kanji: 'Áî∞Ëàé',
            english: 'country',
        },
        {
            id: 'n-sekai',
            romaji: 'sekai',
            hiragana: '„Åõ„Åã„ÅÑ',
            kanji: '‰∏ñÁïå',
            english: 'world',
        },
        {
            id: 'n-ie',
            romaji: 'ie',
            hiragana: '„ÅÑ„Åà',
            kanji: 'ÂÆ∂',
            english: 'house',
        },
        {
            id: 'n-kuruma',
            romaji: 'kuruma',
            hiragana: '„Åè„Çã„Åæ',
            kanji: 'Ëªä',
            english: 'car',
        },
        {
            id: 'n-michi',
            romaji: 'michi',
            hiragana: '„Åø„Å°',
            kanji: 'ÈÅì',
            english: 'street / road',
        },
        {
            id: 'n-omise',
            romaji: 'omise',
            hiragana: '„Åä„Åø„Åõ',
            kanji: '„ÅäÂ∫ó',
            english: 'shop',
        },
/*
        {
            id: 'n-doa',
            romaji: 'doa',
            katakna: '„Éâ„Ç¢',
            english: 'door',
        },

table,

*/
        {
            id: 'n-isu',
            romaji: 'isu',
            hiragana: '„ÅÑ„Åô',
            kanji: 'Ê§ÖÂ≠ê',
            english: 'chair',
        },
        {
            id: 'n-mado',
            romaji: 'mado',
            hiragana: '„Åæ„Å©',
            kanji: 'Á™ì',
            english: 'window',
        },
        {
            id: 'n-shinbun',
            romaji: 'shinbun',
            hiragana: '„Åó„Çì„Å∂„Çì',
            kanji: 'Êñ∞ËÅû',
            english: 'newspaper',
        },
        {
            id: 'n-hon',
            romaji: 'hon',
            hiragana: '„Åª„Çì',
            kanji: 'Êú¨',
            english: 'book',
        },
        {
            id: 'n-hana',
            romaji: 'hana',
            hiragana: '„ÅØ„Å™',
            kanji: 'Ëä±',
            english: 'flower',
        },
        {
            id: 'n-kasa',
            romaji: 'kasa',
            hiragana: '„Åã„Åï',
            kanji: '',
            english: 'umbrella',
        },
        {
            id: 'n-gakk≈ç',
            romaji: 'gakk≈ç',
            hiragana: '„Åå„Å£„Åì„ÅÜ',
            kanji: 'Â≠¶Ê†°',
            english: 'school',
        },
        {
            id: 'n-by≈çin',
            romaji: 'by≈çin',
            hiragana: '„Å≥„Çá„ÅÜ„ÅÑ„Çì',
            kanji: 'ÁóÖÈô¢',
            english: 'hospital',
        },
        {
            id: 'n-asa',
            romaji: 'asa',
            hiragana: '„ÅÇ„Åï',
            kanji: 'Êúù',
            english: 'morning',
        },
        {
            id: 'n-gogo',
            romaji: 'gogo',
            hiragana: '„Åî„Åî',
            kanji: 'ÂçàÂæå',
            english: 'afternoon',
        },
        {
            id: 'n-yoru',
            romaji: 'yoru',
            hiragana: '„Çà„Çã',
            kanji: 'Â§ú',
            english: 'night',
        },
        {
            id: 'n-kaisha',
            romaji: 'kaisha',
            hiragana: '„Åç„ÅÇ„Åó„ÇÉ',
            kanji: '‰ºöÁ§æ',
            english: 'company',
        },
        {
            id: 'n-isha',
            romaji: 'isha',
            hiragana: '„ÅÑ„Åó„ÇÉ',
            kanji: 'ÂåªÂ∏´',
            english: 'doctor',
        },
        {
            id: 'n-unten-sha',
            romaji: 'unten-sha',
            hiragana: '„ÅÜ„Å¶„Çì„Åó„ÇÉ',
            kanji: 'ÈÅãËª¢ËÄÖ',
            english: 'driver',
        },
        {
            id: 'n-Sh≈çb≈ç-shi',
            romaji: 'Sh≈çb≈ç-shi',
            hiragana: '„Åó„Çá„ÅÜ„Åº„ÅÜ-„Åó',
            kanji: 'Ê∂àÈò≤Â£´',
            english: 'firefighter',
        },
        {
            id: 'n-bengoshi',
            romaji: 'bengoshi',
            hiragana: '„Åπ„Çì„Åî„Åó',
            kanji: 'ÂºÅË≠∑Â£´',
            english: 'lawyer',
        },
        {
            id: 'n-j≈´i',
            romaji: 'j≈´i',
            hiragana: '„Åò„ÇÖ„ÅÜ„ÅÑ',
            kanji: 'Áç£Âåª',
            english: 'vet',
        },
        {
            id: 'n-kangoshi',
            romaji: 'kangoshi',
            hiragana: '„Åã„Çì„Åî„Åó',
            kanji: 'ÁúãË≠∑Â©¶',
            english: '',
        },
        {
            id: 'n-ban',
            romaji: 'ban',
            hiragana: '„Å∞„Çì',
            kanji: 'Â§ú',
            english: 'evening',
        },
        {
            id: 'n-gozen',
            romaji: 'gozen',
            hiragana: '„Åî„Åú„Çì',
            kanji: 'ÂçàÂâç',
            english: 'a.m.',
        },
        {
            id: 'n-gogo',
            romaji: 'gogo',
            hiragana: '„Åî„Åî',
            kanji: 'ÂçàÂæå',
            english: 'p.m.',
        },
        {
            id: 'n-hayai',
            romaji: 'hayai',
            hiragana: '„Å≤„ÇÑ„ÅÑ',
            kanji: 'Êó©„ÅÑ',
            english: 'early',
        },
        {
            id: 'n-osoi',
            romaji: 'osoi',
            hiragana: '„Åä„Åù„ÅÑ',
            kanji: 'ÈÅÖ„ÅÑ',
            english: 'late',
        },
        {
            id: 'n-ima',
            romaji: 'ima',
            hiragana: '„ÅÑ„Åæ',
            kanji: '‰ªä',
            english: 'now',
        },
        {
            id: 'n-tsuki',
            romaji: 'tsuki',
            hiragana: '„Å§„Åç',
            kanji: 'Êúà',
            english: 'month',
        },
        {
            id: 'n-toshi',
            romaji: 'toshi',
            hiragana: '„Å®„Åó',
            kanji: 'Âπ¥',
            english: 'toshi',
        },
        {
            id: 'n-hi',
            romaji: 'hi',
            hiragana: '„Å≤',
            kanji: 'Êó•',
            english: 'day',
        },
        {
            id: 'n-sh≈´matsu',
            romaji: 'sh≈´matsu',
            hiragana: '„Åó„ÇÖ„ÅÜ„Åæ„Å§',
            kanji: 'ÈÄ±Êú´',
            english: 'weekend',
        },
        {
            id: 'n-sh≈´',
            romaji: 'sh≈´',
            hiragana: '„Åó„ÇÖ„ÅÜ',
            kanji: 'ÈÄ±',
            english: 'week',
        },
        {
            id: 'n-haru',
            romaji: 'haru',
            hiragana: '„ÅØ„Çã',
            kanji: 'Êò•',
            english: 'spring',
        },
        {
            id: 'n-natsu',
            romaji: 'natsu',
            hiragana: '„Å™„Å§',
            kanji: 'Â§è',
            english: 'summer',
        },
        {
            id: 'n-aki',
            romaji: 'aki',
            hiragana: '„ÅÇ„Åç',
            kanji: 'Áßã',
            english: 'autumn',
        },
        {
            id: 'n-fuyu',
            romaji: 'fuyu',
            hiragana: '„Åµ„ÇÜ',
            kanji: 'ÂÜ¨',
            english: 'winter',
        },
        {
            id: 'n-atsui',
            romaji: 'atsui',
            hiragana: '„ÅÇ„Å§„ÅÑ',
            kanji: '',
            english: 'hot',
        },
        {
            id: 'n-atatakai',
            romaji: 'atatakai',
            hiragana: '„ÅÇ„Åü„Åü„Åã„ÅÑ',
            kanji: 'Êöñ„Åã„ÅÑ',
            english: 'warm',
        },
        {
            id: 'n-samui',
            romaji: 'samui',
            hiragana: '„Åï„ÇÄ„ÅÑ',
            kanji: '',
            english: 'cold',
        },
        {
            id: 'n-ame',
            romaji: 'ame',
            hiragana: '„ÅÇ„ÇÅ',
            kanji: 'Èõ®',
            english: 'rain/wet',
        },
        {
            id: 'n-yuki',
            romaji: 'yuki',
            hiragana: '„ÇÜ„Åç',
            kanji: 'Èõ™',
            english: 'snow',
        },
        {
            id: 'n-arare',
            romaji: 'arare',
            hiragana: '„ÅÇ„Çâ„Çå',
            kanji: '',
            english: 'hail',
        },
        {
            id: 'n-k≈çri',
            romaji: 'k≈çri',
            hiragana: '„Åì„ÅÜ„Çä',
            kanji: 'Ê∞∑',
            english: 'ice',
        },
        {
            id: 'n-kaze',
            romaji: 'kaze',
            hiragana: '„Åã„Åú',
            kanji: 'È¢®',
            english: 'wind',
        },
/*
        {
            id: 'n-',
            romaji: '',
            hiragana: '',
            kanji: '',
            english: '',
        },
        {
            id: 'n-',
            romaji: '',
            hiragana: '',
            kanji: '',
            english: '',
        },
        {
            id: 'n-',
            romaji: '',
            hiragana: '',
            kanji: '',
            english: '',
        },

*/


/*
        {
            id: 'v-au',
            romaji: 'au',
            hiragana: "„ÅÇ„ÅÜ",
            kanji: '‰ºö„ÅÜ',
            english: 'to meet, to see',
        },
        {
        id: 'v-aku',
        romaji: 'aku',
        hiragana: '„ÅÇ„Åè',
        kanji: 'Èñã„Åè',
        english: 'to open, to become open'
    },
    {
        id: 'v-akeru',
        romaji: 'ake.ru',
        hiragana: '„ÅÇ„Åë„Çã',
        kanji: 'Èñã„Åë„Çã',
        english: 'to open',
    },
    {
        id: 'v-ageru',
        romaji: 'age.ru',
        hiragana: '„ÅÇ„Åí„Çã',
        kanji: '‰∏ä„Åí„Çã',
        english: 'to give',
    },
    {
        id: 'v-asobu',
        romaji: 'asobu',
        hiragana: '„ÅÇ„Åù„Å∂',
        kanji: 'ÈÅä„Å∂',
        english: 'to play, to make a visit',
    },
    {
        id: 'v-abiru',
        romaji: 'abi.ru',
        hiragana: '„ÅÇ„Å≥„Çã',
        kanji: '„ÅÇ„Å≥„Çã',
        english: 'to bathe, to shower',
    },
    {
        id: 'v-arau',
        romaji: 'arau',
        hiragana: '„ÅÇ„Çâ„ÅÜ',
        kanji: 'Ê¥ó„ÅÜ',
        english: 'to wash',
    },
    {
        id: 'v-aru',
        romaji: 'aru',
        hiragana: '„ÅÇ„Çã',
        kanji: '„ÅÇ„Çã',
        english: 'to be, to exist, to live, to have',
    },
    {
        id: 'v-aruku',
        romaji: 'aruku',
        hiragana: '„ÅÇ„Çã„Åè',
        kanji: 'Ê≠©„Åè',
        english: 'to walk',
    },
    {
        id: 'v-iu',
        romaji: 'iu',
        hiragana: '„ÅÑ„ÅÜ',
        kanji: 'Ë®Ä„ÅÜ',
        english: 'to say, to name, to make a noise',
    },
    {
        id: 'v-iku',
        romaji: 'iku',
        hiragana: '„ÅÑ„Åè',
        kanji: 'Ë°å„Åè',
        english: 'to go',
    },
    {
        id: 'v-i.ru',
        romaji: 'i.ru',
        hiragana: '„ÅÑ„Çã',
        kanji: 'Â±Ö„Çã',
        english: 'to be (animate), to exist (hum)',
    },
    {
        id: 'v-iru',
        romaji: 'iru',
        hiragana: '„ÅÑ„Çã',
        kanji: 'Ë¶Å„Çã',
        english: 'to need',
    },
    {
        id: 'v-ire.ru',
        romaji: 'ire.ru',
        hiragana: '„ÅÑ„Çå„Çã',
        kanji: 'ÂÖ•„Çå„Çã',
        english: 'to put in',
    },
    {
        id: 'v-utau',
        romaji: 'utau',
        hiragana: '„ÅÜ„Åü„ÅÜ',
        kanji: 'Ê≠å„ÅÜ',
        english: 'to sing',
    },
    {
        id: 'v-umare.ru',
        romaji: 'umare.ru',
        hiragana: '„ÅÜ„Åæ„Çå„Çã',
        kanji: 'Áîü„Åæ„Çå„Çã',
        english: 'to be born',
    },
    {
        id: 'v-uru',
        romaji: 'uru',
        hiragana: '„ÅÜ„Çã',
        kanji: 'Â£≤„Çã',
        english: 'to sell',
    },
    {
        id: 'v-oki.ru',
        romaji: 'oki.ru',
        hiragana: '„Åä„Åç„Çã',
        kanji: 'Ëµ∑„Åç„Çã',
        english: 'to get up, to rise',
    },
    {
        id: 'v-oku',
        romaji: 'oku',
        hiragana: '„Åä„Åè',
        kanji: 'ÁΩÆ„Åè',
        english: 'to put, to place',
    },
    {
        id: 'v-oshie.ru',
        romaji: 'oshieru',
        hiragana: '„Åä„Åó„Åà„Çã',
        kanji: 'Êïô„Åà„Çã',
        english: 'to teach, to inform',
    },
    {
        id: 'v-osu',
        romaji: 'osu',
        hiragana: '„Åä„Åô',
        kanji: 'Êäº„Åô',
        english: 'to push, to press',
    },
    {
        id: 'v-oboe.ru',
        romaji: 'oboe.ru',
        hiragana: '„Åä„Åº„Åà„Çã',
        kanji: 'Ë¶ö„Åà„Çã',
        english: 'to remember, to memorise',
    },
    {
        id: 'v-oyogu',
        romaji: 'oyogu',
        hiragana: '„Åä„Çà„Åê',
        kanji: 'Ê≥≥„Åê',
        english: 'to swim',
    },
    {
        id: 'v-ori.ru',
        romaji: 'ori.ru',
        hiragana: '„Åä„Çä„Çã',
        kanji: 'Èôç„Çä„Çã',
        english: 'to get off, to disembark, to dismount',
    },
    {
        id: 'v-owaru',
        romaji: 'owaru',
        hiragana: '„Åä„Çè„Çã',
        kanji: 'ÁµÇ„Çã',
        english: 'to finish, to close',
    },
    {
        id: 'v-kau',
        romaji: 'kau',
        hiragana: '„Åã„ÅÜ',
        kanji: 'Ë≤∑„ÅÜ',
        english: 'to buy',
    },
    {
        id: 'v-kaesu',
        romaji: 'kaesu',
        hiragana: '„Åã„Åà„Åô',
        kanji: 'Ëøî„Åô',
        english: 'to return something',
    },
    {
        id: 'v-kaeru',
        romaji: 'kaeru',
        hiragana: '„Åã„Åà„Çã',
        kanji: 'Â∏∞„Çã',
        english: 'to go home, to return',
    },
    {
        id: 'v-kakaru',
        romaji: 'kakaru',
        hiragana: '„Åã„Åã„Çã',
        kanji: 'Kana*',
        english: 'to take (eg time, money)',
    },

*/
    
    ];

/*
    {
        id: '',
        romaji: '',
        hiragana: '„Åã„Åè',
        kanji: 'Êõ∏„Åè',
        english: 'to write',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åã„Åë„Çã',
        kanji: 'Kana*',
        english: 'to put on (eg glasses)',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åã„Åë„Çã',
        kanji: 'Kana*',
        english: 'to dial/call (eg phone)',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åã„Åô',
        kanji: 'Ë≤∏„Åô',
        english: 'to lend',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åã„Å∂„Çã',
        kanji: 'Kana*',
        english: 'to wear, to put on (head)',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åã„Çä„Çã',
        kanji: 'ÂÄü„Çä„Çã',
        english: 'to borrow, to have a loan',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åç„Åà„Çã',
        kanji: 'Ê∂à„Åà„Çã',
        english: 'to go out, to vanish',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åç„Åè',
        kanji: 'ËÅû„Åè',
        english: 'to hear, to listen, to ask',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åç„Çã',
        kanji: 'Âàá„Çã',
        english: 'to cut, to chop',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åç„Çã',
        kanji: 'ÁùÄ„Çã',
        english: 'to wear, to put on (from shoulders down)',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åè„ÇÇ„Çã',
        kanji: 'Êõá„Çã',
        english: 'to become cloudy, to become dim',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åë„Åô',
        kanji: 'Ê∂à„Åô',
        english: 'to erase, to delete, to turn off power',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åì„Åü„Åà„Çã',
        kanji: 'Á≠î„Åà„Çã',
        english: 'to answer, to reply',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åì„Åæ„Çã',
        kanji: 'Âõ∞„Çã',
        english: 'to be worried, to be bothered',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åï„Åô',
        kanji: 'Â∑Æ„Åô',
        english: 'to raise (stretch out) hands, to raise (eg umbrella)',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åó„Åæ„Çã',
        kanji: 'Èñâ„Åæ„Çã',
        english: 'to close, to be closed',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åó„ÇÅ„Çã',
        kanji: 'Èñâ„ÇÅ„Çã',
        english: 'to close, to shut',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åó„ÇÅ„Çã',
        kanji: 'Á∑†„ÇÅ„Çã',
        english: 'to tie, to fasten',
    },
    {
        id: '',
        romaji: '',
        hiragana: '„Åó„Çã',
        kanji: 'Áü•„Çã',
        english: 'to know, to understand',
    },
    ];
*/

    var INITIAL_WATERLINE = 15;
    var TOO_SOON_SIZE = 6;

    var data = {
        // The maximum question to present. The waterline will be
        // increased as the confidence in the concepts beneath the
        // waterline raises above a threshold.
        waterline_index: stats.global && stats.global.waterline_index ? stats.global.waterline_index : INITIAL_WATERLINE,
        // The current "direction" of the question
        direction: make_direction('hiragana', 'romaji', 'h'),
        // These are the "answers" that will be present.
        concepts: [],
        // The current answer we are looking for which should obviously be present in concepts
        answer: {},
        // When true, show the correct answer dialog
        show_correct: false,
        // When true, show the wrong answer dialog
        show_wrong: false,
        // when true, show the debug extra information
        debug: false,

        // functions used during rendering
        get_question_text: get_question_text,
        get_question_answer_text: get_question_answer_text,
        get_answer_text: get_answer_text,
        get_concept: get_concept,
        font_family: FONT_FAMILIES[0],
    };

    function check_answer(index) {
        data.show_correct = (data.concepts[index].id == data.answer.id);
        data.show_wrong = !data.show_correct;
    }

    function select_next_question() {   
        update_statistics();
        data.show_correct = data.show_wrong = false;

        maybe_increase_waterline();

        var direction = random_element(directions);
        console.log('direction is ', direction);

        var concepts = get_sorted_concepts(direction);
        var question = get_best_question_data(concepts, direction);
        data.concepts = question.concepts;
        data.answer = question.answer;
        data.direction = direction;
        data.question_score = question.score;
        console.log("data", data);
    }

    function get_random_scored_concept(sorted_concepts) {
        var random = 1.0;
        for (var i = 0; i < 8; i++) {
            var next = Math.random();
            if (next < random) {
                random = next;
            }
        }
        var index = Math.floor(random * sorted_concepts.length);
        var concept = sorted_concepts[index];
        // console.log("random_concept", sorted_concepts, random, index, concept);
        return concept;
    }

    function update_statistics() {
        if (!stats.global) {
            stats.global = {};
        }
        stats.global.waterline_index = data.waterline_index;

        console.log(data.answer);
        var question_id = data.answer.id;
        var direction_name = data.direction.direction_name;
        add_last_answer(question_id);
        console.log('direction_name', direction_name);
        var stat = get_stat(question_id);
        if (data.show_correct) {
            increment_direction_statistic(stat, direction_name, 'correct');
        } else {
            increment_direction_statistic(stat, direction_name, 'wrong');
        }
        stats[question_id] = stat;
        localStorage.setItem("stats", JSON.stringify(stats));
        console.log('stats is', stats);
    }

    var last_answers = [];

    function add_last_answer() {
      last_answers.push(data.answer.id);
      if (last_answers.length > TOO_SOON_SIZE) {
        last_answers.shift();
      }
    }

    function is_too_early(question) {
      return (last_answers.indexOf(question.answer.id) >= 0);
    }

    function increment_direction_statistic(stat, direction_name, property_name) {
      stat[direction_name] = stat[direction_name] ? stat[direction_name] : {
        correct: {},
        wrong: {},
        last_correct_time: {},
        last_wrong_time: {},
      };
      stat[direction_name][property_name] = stat[direction_name][property_name]
        ? 0
        : stat[direction_name][property_name];
      stat[direction_name][property_name] = stat[direction_name][property_name] + 1;
      stat[direction_name]['last_' + property_name + '_time'] = new Date().getTime();
      stat['all_' + property_name] = stat['all_' + property_name] ? (stat['all_' + property_name] + 1) : 1;
      stat.all_last_answers = update_last_answers(stat.all_last_answers, property_name);
      console.log("modified stat is", stat);
    }

    function update_last_answers(last_answers, property_name) {
        var bit = (property_name == 'correct') ? 1 : 0;
        // Just keep the last 24 latest answers as this will save a bit of
        // space and answers older than that are of less value
        return (((last_answers ? last_answers : 0) << 1) & 0xffffff) | bit;
    }

    function last_answers_to_confidence(last_answers) {
        var last_four = (last_answers ? last_answers : 0) & 0xf;
        var result = 0.0;
        if (last_four & 0x1) {
            result += 0.50;
        }
        if (last_four & 0x2) {
            result += 0.25;
        }
        if (last_four & 0x4) {
            result += 0.15;
        }
        if (last_four & 0x8) {
            result += 0.10;
        }
        return result;
    }

    function get_stat(question_id) {
        return stats[question_id]
            ? stats[question_id]
            : {};
    }

    function maybe_increase_waterline() {
        if (data.waterline_index >= all_concepts.length) {
            console.log("no more concepts versus waterline");
            return;
        }
        var not_correct = all_not_correct_in_any_direction();
        console.log("all not correct " + not_correct);
        if (not_correct > 8) {
            console.log("too many concepts never answered correctly to increase waterline");
            return;
        }
        var average_score = compute_average_score();
        if (average_score > 0.80) {
            console.log("increasing waterline as average score is above 80%", average_score);
            data.waterline_index += 1;
            console.log("increased waterline to ", data.waterline_index);
        } else {
            console.log("keeping waterline at ", data.waterline_index);
            console.log("not increasing waterline since average is below 80%", average_score);
        }
    }

    function all_not_correct_in_any_direction() {
        var result = 0;
        for (var i = 0; i < data.waterline_index; i++) {
            result += number_of_directions_never_correct(all_concepts[i]);
        }
        return result;
    }

    function number_of_directions_never_correct(concept) {
        var concept_id = concept.id;
        var stat = get_stat(concept_id);
        var concept_id_prefix = concept_id.charAt(0);
        var result = 0;
        for (var j = 0; j < directions.length; j++) {
            var direction = directions[j];
            if (direction.direction_id_match.includes(concept_id_prefix)) {
                if (!stat[direction.direction_name]
                    || !stat[direction.direction_name].correct
                    || stat[direction.direction_name].correct <= 0) {
                    result += 1;
                }
            }
        }
        return result;
    }

    function compute_average_score() {
        var total_confidence = 0.0;
        var total_count = 0;
        for (var i = 0; i < data.waterline_index; i++) {
            var question_id = all_concepts[i].id;
            var stat = get_stat(question_id);
            if ('all_last_answers' in stat) {
                total_confidence += last_answers_to_confidence(stat.all_last_answers);
                total_count += 1;
            }
        }
        if (total_count == 0) {
            return 0.0;
        }
        return  total_confidence / total_count;
    }
        
    function get_best_question_data(sorted_concepts, direction) {
        var now = new Date().getTime();

        // Select the highest scoring question according the question
        // scoring function which looks for concepts that haven't been
        // answered correctly in the longest amount of time, etc.

        var question = get_question_data(sorted_concepts, now, direction);
        for (var i = 0; i < 1000; i++) {
            var q2 = get_question_data(sorted_concepts, now, direction);
            if (q2.score > question.score && 
                !is_too_early(question)) {
                question = q2;
            }
        }
        return question;
    }

    function get_question_data(sorted_concepts, now, direction) {
        var result = {};
        result.concepts = [];
        var number_of_concepts = 2 + Math.floor(Math.random() * 4);
        for (var i = 0; i < number_of_concepts; i++) {
            while (true) {
                var concept = get_random_scored_concept(sorted_concepts).concept;
                if (!concept) {
                    throw "concept is not true";
                }
                if (result.concepts.indexOf(concept) < 0) {
                    result.concepts.push(concept);
                    break;
                }
            }
        }
        // console.log("get_question_data", result);
        var index = Math.floor(Math.random() * result.concepts.length);
        result.answer = result.concepts[index];
        result.direction = direction;
        result.score = score_question(now, result, direction);
        return result;
    }

    function score_question(now, result, direction) {
        var score = 0.0;
        var total_directions_never_correct = 0;
        for (var i = 0; i < result.concepts.length; i++) {
            var concept = result.concepts[i];
            var stat = get_stat(concept);
            score += (now - ((stat[direction.direction_name])
                             && (stat[direction.direction_name].last_correct_time)
                             ? (stat[direction.direction_name].last_correct_time)
                             : 0));
            total_directions_never_correct += number_of_directions_never_correct(concept);
        }
        score = (score / result.concepts.length);
        if (total_directions_never_correct > 0) {
            score *= total_directions_never_correct;
        }
        // bump up the score if the answer has been answered correctly less than 10 times
        var concept = result.answer;
        var stat = get_stat(concept);
        var stat_all_correct = (stat.all_correct ? stat.all_correct : 0);
        if (stat_all_correct < 1) {
            score *= 2.2;
        } if (stat_all_correct < 2) {
            score *= 2.0;
        } else if (stat_all_correct < 4) {
            score *= 1.8;
        } else if (stat_all_correct < 6) {
            score *= 1.6;
        } else if (stat_all_correct < 8) {
            score *= 1.4;
        } else if (stat_all_correct < 10) {
            score *= 1.2;
        }
        if (number_of_directions_never_correct(concept)) {
            score *= 2.5;
        }
        return score;
    }

    function score_concept(concept) {
        var score = 0.0;
        var total_directions_never_correct = number_of_directions_never_correct(concept);
        if (total_directions_never_correct > 0) {
            return 1.0 * total_directions_never_correct;
        }
        var stat = get_stat(concept.id);
        if ('all_last_answers' in stat) {
            var result = 1.0 - last_answers_to_confidence(stat.all_last_answers);
            return result;
        } else {
            return 1.0;
        }
    }

    function get_sorted_concepts(direction) {
        var array = [];
        // FIXME should be &&
        for (var i = 0; i < data.waterline_index || i < all_concepts.length; i++) {
            var concept = all_concepts[i];
            var prefixChar = concept.id.charAt(0);
            if (direction.direction_id_match.includes(prefixChar)) {
               array.push({
                     score: score_concept(concept),
                         concept: concept,
               });
           }
        }
        array.sort(function (a, b) {return b.score - a.score;});
        return array;
    }

    function show_debug() {
        data.debug = true;
    }

    function hide_debug() {
        data.debug = false;
    }

    function change_font() {
        var new_font_family = '';
        do {
          new_font_family = random_element(FONT_FAMILIES);
        } while (new_font_family == data.font_family);
        data.font_family = new_font_family;
        console.log(data.font_family);
    }

    var app = new Vue({
        el: '#app',
        data: data,
    });

    function random_element(items) {
      return items[Math.floor(Math.random() * items.length)];
    }

    select_next_question();
  </script>
</html>
